---
import type { CollectionEntry } from "astro:content";
import BaseLayout from "./BaseLayout.astro";
import AdSlot from "../components/AdSlot.astro";
import { SITE, KEYWORDS } from "../consts";

interface Props {
  post: CollectionEntry<"blog">;
}

const { post } = Astro.props;

const canonicalUrl = post.data.canonical ?? `${SITE.url}/blog/${post.slug}/`;
const schema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  headline: post.data.title,
  description: post.data.description,
  datePublished: post.data.date.toISOString(),
  dateModified: post.data.date.toISOString(),
  author: {
    "@type": "Organization",
    name: "TupeloHVAC.com"
  },
  publisher: {
    "@type": "Organization",
    name: "TupeloHVAC.com"
  },
  image: post.data.featured_image ? `${SITE.url}${post.data.featured_image}` : `${SITE.url}/brand/logo.svg`,
  mainEntityOfPage: canonicalUrl
};
---

<BaseLayout
  title={`${post.data.title} | TupeloHVAC.com`}
  description={post.data.description}
  canonical={canonicalUrl}
  type="article"
  image={post.data.featured_image ? `${SITE.url}${post.data.featured_image}` : `${SITE.url}/brand/logo.svg`}
  keywords={[post.data.primary_keyword, ...post.data.keywords, ...KEYWORDS]}
  structuredData={schema}
>
  <article class="container section blog-post">
    <p class="eyebrow">{post.data.category} | {post.data.date.toLocaleDateString()}</p>
    <h1>{post.data.title}</h1>
    <p class="lede">{post.data.description}</p>
    {
      post.data.featured_image && (
        <figure>
          <img src={post.data.featured_image} alt={post.data.featured_image_alt ?? post.data.title} />
          {post.data.pexels_photographer && (
            <figcaption>
              Photo:{" "}
              <a href={post.data.pexels_photographer_url} rel="noopener noreferrer" target="_blank">
                {post.data.pexels_photographer}
              </a>
            </figcaption>
          )}
        </figure>
      )
    }
    <p class="guide-link"><strong>Related:</strong> <a href="/tupelo-hvac-guide/">Tupelo HVAC Guide</a></p>
    <AdSlot placement="blog_in_content" />
    <div class="content">
      <slot />
    </div>
    <p class="guide-link"><strong>Related:</strong> <a href="/tupelo-hvac-guide/">Tupelo HVAC Guide</a></p>
  </article>
</BaseLayout>

<style>
  .blog-post {
    max-width: 860px;
  }
  .lede {
    font-size: 1.14rem;
    color: var(--color-muted);
  }
  figure {
    margin: var(--space-5) 0;
  }
  figure img {
    width: 100%;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-line);
  }
  figcaption {
    margin-top: 0.5rem;
    color: var(--color-muted);
    font-size: 0.9rem;
  }
  .guide-link {
    padding: var(--space-3);
    border-left: 4px solid var(--color-accent);
    background: #fff7f0;
  }
  .content :global(h2) {
    margin-top: var(--space-6);
  }
  .content :global(.cta-block) {
    border: 1px solid var(--color-line);
    border-radius: var(--radius-md);
    padding: var(--space-4);
    background: #fff;
  }
</style>
